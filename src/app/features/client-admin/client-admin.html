<div class="container">
  <mat-toolbar class="page-header mat-elevation-z2">
    <div class="header-container">

      <div class="title-group">
        <div class="main-title">
          <mat-icon>settings</mat-icon>
          <h1>Панель администратора</h1>
        </div>
        <span class="stats-badge">
          Всего клиентов в базе: <strong>{{ allPatients().length }}</strong>
        </span>
      </div>

      <div class="spacer"></div>

      <div class="actions">
        <button mat-flat-button color="primary" routerLink="/client/add">
          <mat-icon>person_add</mat-icon>
          <span>Добавить пациента</span>
        </button>
      </div>

    </div>
  </mat-toolbar>

  <!-- SEARCHBAR -->
    <div class="filter-row">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Поиск пациента</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input
            matInput
            placeholder="Начните вводить имя..."
            (input)="onSearchChange($event)">
          @if (searchQuery()) {
            <button mat-icon-button matSuffix (click)="clearSearch()">
              <mat-icon>close</mat-icon>
            </button>
          }
        </mat-form-field>
      </div>
      <mat-button-toggle-group
        [value]="genderFilter()"
        (change)="setGenderFilter($event.value)"
        appearance="standard"
        class="gender-toggle">
        <mat-button-toggle value="all">Все</mat-button-toggle>
        <mat-button-toggle value="male">♂️М</mat-button-toggle>
        <mat-button-toggle value="female">♀️Ж</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

 <div class="patient-grid">
    @for (user of filteredPatients(); track user.id) {
      <mat-card class="modern-card">

        <div class="card-clickable-area"
             [routerLink]="['/client/view', user.id]"
             matRipple>
          <div class="card-main-info">
            <img [src]="user.avatar" alt="Avatar" class="patient-avatar">
            <div class="text-block">
              <h3 class="patient-name">{{ user.surname }} {{ user.name }}</h3>
              <span class="patient-meta">
                {{ user.gender === 'male' ? '♂️ Муж.' : '♀️ Жен.' }} •
                {{ user.birthdate | date:'dd.MM.yyyy' }}
              </span>
            </div>
          </div>

          <div class="card-body">
            <div class="diagnosis-label">Диагноз</div>
            <p class="diagnosis-text">{{ user.description || 'Не указан' }}</p>
          </div>
        </div>

        <mat-divider></mat-divider>

        <mat-card-actions class="card-actions-panel">
          <div class="action-buttons">
            <button mat-icon-button
                    [routerLink]="['/client/view', user.id]"
                    matTooltip="Просмотр"
                    color="primary">
              <mat-icon>visibility</mat-icon>
            </button>

            <button mat-icon-button
                    [routerLink]="['/client/edit', user.id]"
                    matTooltip="Редактировать"
                    color="accent">
              <mat-icon>edit</mat-icon>
            </button>
          </div>

          <button mat-icon-button
                  (click)="delete(user.id)"
                  matTooltip="Удалить пациента"
                  class="delete-btn">
            <mat-icon>delete_sweep</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    }
  </div>
</div>
